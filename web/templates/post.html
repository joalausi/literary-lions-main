{{ define "post.html" }}{{ template "base.html" . }}{{ end }}

{{ define "title" }}{{ .Post.Title }} — Literary Lions{{ end }}

{{ define "content" }}
  <article class="post">
    <h1 class="post-title">{{ .Post.Title }}</h1>
    <div class="meta">by {{ .Post.Username }} <span class="dot"></span> {{ .Post.CreatedAt }}</div>

    {{ if .PostCategories }}
      <div class="tags">
        {{ range .PostCategories }}<span class="tag">{{ . }}</span>{{ end }}
      </div>
    {{ end }}

    <div class="body">{{ .Post.Content }}</div>

    <div class="actions">
      {{ if .User }}
        <form method="post" action="/react" class="inline">
          <input type="hidden" name="kind" value="post">
          <input type="hidden" name="id" value="{{ .Post.ID }}">
          <input type="hidden" name="v" value="1">
          <button class="btn" type="submit">👍 {{ .PostLikes }}</button>
        </form>
        <form method="post" action="/react" class="inline">
          <input type="hidden" name="kind" value="post">
          <input type="hidden" name="id" value="{{ .Post.ID }}">
          <input type="hidden" name="v" value="-1">
          <button class="btn" type="submit">👎 {{ .PostDislikes }}</button>
        </form>
      {{ else }}
        <div class="reaction">👍 {{ .PostLikes }} <span class="dot"></span> 👎 {{ .PostDislikes }}</div>
      {{ end }}
    </div>
  </article>

  <div id="comments">
    <h2 class="h2">Comments</h2>

    {{ if .Comments }}
      <ul class="comment-list">
        {{ range .Comments }}
          <li class="comment">
            <div class="head">
              <span class="author">{{ .Username }}</span>
              <span class="time">{{ .CreatedAt }}</span>
            </div>
            <div class="text">{{ .Content }}</div>
            <div class="actions">
              {{ if $.User }}
                <form method="post" action="/react" class="inline">
                  <input type="hidden" name="kind" value="comment">
                  <input type="hidden" name="id" value="{{ .ID }}">
                  <input type="hidden" name="v" value="1">
                  <button class="btn sm" type="submit">👍 {{ .Likes }}</button>
                </form>
                <form method="post" action="/react" class="inline">
                  <input type="hidden" name="kind" value="comment">
                  <input type="hidden" name="id" value="{{ .ID }}">
                  <input type="hidden" name="v" value="-1">
                  <button class="btn sm" type="submit">👎 {{ .Dislikes }}</button>
                </form>
              {{ else }}
                <div class="reaction">👍 {{ .Likes }} <span class="dot"></span> 👎 {{ .Dislikes }}</div>
              {{ end }}
            </div>
          </li>
        {{ end }}
      </ul>
    {{ else }}
      <p class="muted">No comments yet.</p>
    {{ end }}

    {{ if .User }}
      <form method="post" action="/comment" class="mt-3">
        <input type="hidden" name="post_id" value="{{ .Post.ID }}">
        <textarea name="content" required></textarea>
        <div class="form-actions">
          <button class="btn primary" type="submit">Comment</button>
        </div>
      </form>
    {{ else }}
      <p><a href="/login">Login</a> to comment.</p>
    {{ end }}
  </div>
{{ end }}
